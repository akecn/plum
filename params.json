{"name":"Plum","body":"#Plum\r\n\r\n基于node的Demo服务器。Node作为http请求控制中心，通过`server.json`配置，根据请求\r\n域名，找到所请求的文件，同时根据服务器配置的`hook`，对文件执行解析分发。\r\n\r\n##Use\r\n  \r\n      sudo npm install plum -g\r\n      sudo plum\r\n\r\n依赖php cli和node的less模块，请首先安装。\r\n\r\n##config\r\n\r\n配置文件: `server.json`。配置方式和Apache基本一直，不过没有那么复杂。\r\n\r\n- *port*: 端口，默认80\r\n- *dirIndex*: 目录中默认查找文件\r\n- *servers*: 虚拟主机相关配置，包括域名对应的base路径和特定hooks\r\n- *hooks*: 全局hook，比如.php: php，所有的php文件都会通过`hooks/php.js`执行\r\n- *MIME*: 需要支持的文件类型\r\n\r\n        {\r\n          \"port\": 80,\r\n            \"dirIndex\": [\"index.html\", ..],\r\n            \"servers\": {\r\n              \"a.tbcdn.cn\": {\r\n                \"path\": \"/Users/eward/assets\",\r\n                \"hooks\": {\r\n                  \".css\": [\"proxy\"], \r\n                  ...\r\n                }\r\n              },\r\n              ...\r\n            },\r\n            \"hooks\": {\r\n              \".php\" : [\"php\"],\r\n              \".css\" : [\"less\"]\r\n            },\r\n            \"MIME\": {\r\n              \".js\": \"application/x-javascript\",\r\n              ...\r\n            }\r\n        }\r\n\r\n##hooks\r\n\r\n[文档](https://github.com/shepherdwind/plum/blob/master/hooks/README.md)。\r\nserver.js是入口文件，完成请求分发工作。主要解析过程由hooks目录下的js执行。\r\n\r\n- *origin*\r\n\r\n  origin首先判断请求为文件还是目录，如果是目录，生成目录列表。如果是文件，根据文\r\n  件后缀，初始化相对于的hook，并且接受hook发送数据请求事件。控制文件输出到客户端\r\n  的属性，和错误情况的处理。同时，在没有hook的情况下，完成静态文件读取的功能。\r\n\r\n- *hook*和*hook-simple*\r\n\r\n  这两个是hook规范事例，并没有具体实现，是扩展hook的规范\r\n\r\n- *less*\r\n\r\n  less完成less解析工作，初始化时，判断文件相对应的less文件是否存在，如果存在执行\r\n  less编译，返回结果，如果不存在，退出，交给origin处理。\r\n\r\n- *proxy*\r\n\r\n  淘宝cdn代理实现。初始化时候，首先判断文件在本地是否存在(文件查找规则由请求url\r\n  和 server.json配置的path决定)，如果不存在，从cdn服务器获取数据。如果存在，则退\r\n  出，origin处理自动。\r\n\r\n- *php/cli*\r\n\r\n  通过php cli解析php文件，现在还不支持post和get请求，作为demo环境基本够用，执行\r\n  效率和由php 自身性能决定，和转发者是node还是apache无关。\r\n\r\n- *php/tms*\r\n\r\n  模拟tms函数，生成demo。判断规则是：文件是php，并且含有.tms，tms规则支持tms文件\r\n  引用，不过要求，每次只引用一个文件(`<?php include 'a.tms.php';?>`)，而且文件名\r\n  中含有.tms。demo的数据根据请求的文件名，把后缀改为json，比如访问a.tms.php，demo\r\n  数据源为a.tms.json，运行时，每个函数通过name来定位数据。\r\n\r\n##change log\r\n\r\n- [2012-06-12 15:44:03] \r\n  - 增加`proxy=pre`作为使用预发assets的接口\r\n  - tms规则下，build时，生成文件名对应的html文件，用于fed上预览\r\n  - 去除tms规则下，引用模块文件名必须以`.tms.php`结尾的规则\r\n  - tms规则下，自动生成.json文件，方便修改\r\n  - 增加自动更新提示\r\n\r\n##TODO\r\n\r\n- php使用php-cgi和fpm来执行。对fpm和php-cgi不是很了解，学习中。\r\n- vm模板解析","tagline":"Demo server environment by node","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}